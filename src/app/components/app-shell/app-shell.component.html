<mat-drawer-container class="shell-container" hasBackdrop="false">
  <!-- Main Toolbar -->
  <mat-toolbar color="primary" class="shell-toolbar">
    <!-- Mobile Menu Toggle (only show for authenticated users) -->
    @if (isMobileView() && isAuthenticated()) {
      <button
        matIconButton
        (click)="toggleDrawer()"
        class="menu-toggle"
        [attr.aria-label]="'Toggle navigation menu'"
      >
        <mat-icon>menu</mat-icon>
      </button>
    }

    <!-- Logo -->
    <span class="toolbar-brand">MuShee</span>

    <!-- Spacer -->
    <span class="spacer"></span>

    <!-- Help/Tour Button (only for authenticated users) -->
    @if (isAuthenticated()) {
      <button
        matIconButton
        (click)="onHelpClick()"
        [attr.aria-label]="'Help and tour'"
        matTooltip="Help"
      >
        <mat-icon>help</mat-icon>
      </button>
    }

    <!-- Authenticated User Menu -->
    @if (isAuthenticated()) {
      <button
        matIconButton
        [matMenuTriggerFor]="userMenu"
        class="user-menu-trigger"
        [attr.aria-label]="'User menu'"
      >
        <mat-icon>account_circle</mat-icon>
      </button>

      <!-- User Dropdown Menu -->
      <mat-menu #userMenu="matMenu" class="user-dropdown">
        <button mat-menu-item disabled>
          <mat-icon>person</mat-icon>
          <span>{{ userEmail() }}</span>
        </button>
        <mat-divider></mat-divider>
        <button mat-menu-item (click)="onLogoutClick()">
          <mat-icon>logout</mat-icon>
          <span>Logout</span>
        </button>
      </mat-menu>
    } @else {
      <!-- Unauthenticated User Actions -->
      <button matButton (click)="onNavigation('/login')" class="auth-button">Login</button>

      <button mat-raised-button (click)="onNavigation('/register')" class="auth-button primary">
        Create Account
      </button>
    }
  </mat-toolbar>

  <!-- Navigation Drawer -->
  <mat-drawer
    #drawer
    [mode]="isMobileView() ? 'over' : 'side'"
    [opened]="!isMobileView()"
    [attr.aria-label]="'Navigation menu'"
    class="shell-drawer"
  >
    <nav class="sidebar-nav">
      <mat-nav-list class="nav-list">
        <!-- Authenticated navigation -->
        @if (isAuthenticated()) {
          <mat-list-item
            (click)="onNavigation('/app/library')"
            [class.active]="isRouteActive('/app/library')"
            class="nav-item"
          >
            <mat-icon matListItemIcon>library_music</mat-icon>
            <span matListItemTitle>My Library</span>
          </mat-list-item>
        }

        <!-- Always show Discover -->
        <mat-list-item
          (click)="onNavigation('/app/discover')"
          [class.active]="isRouteActive('/app/discover')"
          class="nav-item"
        >
          <mat-icon matListItemIcon>explore</mat-icon>
          <span matListItemTitle>Discover</span>
        </mat-list-item>
      </mat-nav-list>
    </nav>
  </mat-drawer>

  <!-- Main Content Area -->
  <mat-drawer-content class="shell-content">
    <!-- Router outlet for child routes (/app/library, /app/discover) -->
    <router-outlet />
  </mat-drawer-content>
</mat-drawer-container>
