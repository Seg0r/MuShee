<!-- Main Toolbar -->
<mat-toolbar color="primary" class="shell-toolbar">
  <!-- Mobile Menu Toggle (show only on mobile) -->
  @if (isMobileView()) {
    <button
      mat-icon-button
      (click)="toggleDrawer()"
      class="menu-toggle"
      [attr.aria-label]="'Toggle navigation menu'"
    >
      <mat-icon>menu</mat-icon>
    </button>
  }

  <!-- Logo -->
  <span class="toolbar-brand">MuShee</span>

  <!-- Spacer -->
  <span class="spacer"></span>

  <!-- Dark Mode Toggle (only for authenticated users) -->

  <mat-slide-toggle
    [checked]="isDarkMode()"
    (change)="toggleDarkMode()"
    [attr.aria-label]="'Dark mode toggle'"
    class="toolbar-control theme-toggle"
  >
    Dark mode
  </mat-slide-toggle>

  <!-- Help/Tour Button (only for authenticated users) -->
  @if (isAuthenticated()) {
    <button
      mat-icon-button
      (click)="onHelpClick()"
      [attr.aria-label]="'Help and tour'"
      class="toolbar-control help-button"
    >
      <mat-icon>help</mat-icon>
    </button>
  }

  <!-- Authenticated User Menu -->
  @if (isAuthenticated()) {
    <button
      mat-icon-button
      [matMenuTriggerFor]="userMenu"
      class="toolbar-control user-menu-trigger"
      [attr.aria-label]="'User menu'"
    >
      <mat-icon>account_circle</mat-icon>
    </button>

    <!-- User Dropdown Menu -->
    <mat-menu #userMenu="matMenu">
      <button mat-menu-item disabled>
        <mat-icon>person</mat-icon>
        <span>{{ userEmail() }}</span>
      </button>
      <mat-divider></mat-divider>
      <button mat-menu-item (click)="onLogoutClick()">
        <mat-icon>logout</mat-icon>
        <span>Logout</span>
      </button>
    </mat-menu>
  } @else {
    <!-- Unauthenticated User Actions -->
    <button
      mat-button
      (click)="
        onNavigationClick({ icon: 'login', label: 'Login', path: '/login', requiresAuth: false })
      "
      class="toolbar-control auth-button"
    >
      Login
    </button>
  }
</mat-toolbar>

<!-- Main Layout Container -->
<div class="shell-layout">
  <!-- Left Icon Container (Desktop: sticky, Mobile: hidden) -->
  @if (!isMobileView()) {
    <div
      class="nav-icon-container"
      (mouseenter)="onSidebarHoverEnter()"
      (mouseleave)="onSidebarHoverLeave()"
    >
      <!-- Icon buttons for each navigation item -->
      @for (item of navItems(); track item.path) {
        <button
          mat-icon-button
          (click)="onNavigationClick(item)"
          [class.active]="isRouteActive(item.path)"
          [class.disabled]="isNavItemDisabled(item)"
          [attr.aria-disabled]="isNavItemDisabled(item)"
          class="nav-icon-button"
        >
          <mat-icon>{{ item.icon }}</mat-icon>
        </button>
      }
    </div>
  }

  <!-- Side Navigation Container (Sidenav + Content) -->
  <mat-sidenav-container class="nav-container" [hasBackdrop]="isMobileView()">
    <!-- Side Drawer with Labels (Desktop: side mode with hover, Mobile: over mode) -->
    <mat-sidenav
      #drawer
      [mode]="isMobileView() ? 'over' : 'side'"
      [opened]="isMobileView() ? false : isSidebarHovered()"
      [attr.aria-label]="'Navigation labels'"
      class="nav-drawer"
      [class.mobile]="isMobileView()"
      (mouseenter)="onSidebarHoverEnter()"
      (mouseleave)="onSidebarHoverLeave()"
    >
      <!-- Navigation List with Labels -->
      <nav class="nav-labels">
        <mat-nav-list class="nav-list">
          @for (item of navItems(); track item.path) {
            <mat-list-item
              (click)="onNavigationClick(item)"
              [class.active]="isRouteActive(item.path)"
              [class.disabled]="isNavItemDisabled(item)"
              [attr.aria-disabled]="isNavItemDisabled(item)"
              class="nav-item"
            >
              @if (isMobileView()) {
                <mat-icon matListItemIcon>{{ item.icon }}</mat-icon>
              }
              <span matListItemTitle>{{ item.label }}</span>
            </mat-list-item>
          }
        </mat-nav-list>
      </nav>
    </mat-sidenav>

    <!-- Main Content Area -->
    <mat-sidenav-content class="shell-content">
      <!-- Router outlet for child routes (/app/library, /app/discover) -->
      <router-outlet />
    </mat-sidenav-content>
  </mat-sidenav-container>
</div>
