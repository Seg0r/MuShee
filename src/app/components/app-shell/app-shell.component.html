<mat-drawer-container class="shell-container" hasBackdrop="false">
  <!-- Main Toolbar -->
  <mat-toolbar color="primary" class="shell-toolbar">
    <!-- Mobile Menu Toggle (only show for authenticated users on mobile) -->
    @if (isMobileView() && isAuthenticated()) {
      <button
        matIconButton
        (click)="toggleDrawer()"
        class="menu-toggle"
        [attr.aria-label]="'Toggle navigation menu'"
      >
        <mat-icon>menu</mat-icon>
      </button>
    }

    <!-- Logo -->
    <span class="toolbar-brand">MuShee</span>

    <!-- Spacer -->
    <span class="spacer"></span>

    <!-- Help/Tour Button (only for authenticated users) -->
    @if (isAuthenticated()) {
      <button
        matIconButton
        (click)="onHelpClick()"
        [attr.aria-label]="'Help and tour'"
        matTooltip="Help"
      >
        <mat-icon>help</mat-icon>
      </button>
    }

    <!-- Authenticated User Menu -->
    @if (isAuthenticated()) {
      <button
        matIconButton
        [matMenuTriggerFor]="userMenu"
        class="user-menu-trigger"
        [attr.aria-label]="'User menu'"
      >
        <mat-icon>account_circle</mat-icon>
      </button>

      <!-- User Dropdown Menu -->
      <mat-menu #userMenu="matMenu" class="user-dropdown">
        <button mat-menu-item disabled>
          <mat-icon>person</mat-icon>
          <span>{{ userEmail() }}</span>
        </button>
        <mat-divider></mat-divider>
        <button mat-menu-item (click)="onLogoutClick()">
          <mat-icon>logout</mat-icon>
          <span>Logout</span>
        </button>
      </mat-menu>
    } @else {
      <!-- Unauthenticated User Actions -->
      <button matButton (click)="onNavigation('/login')" class="auth-button">Login</button>

      <button mat-raised-button (click)="onNavigation('/register')" class="auth-button primary">
        Create Account
      </button>
    }
  </mat-toolbar>

  <!-- Navigation Drawer (always side mode for authenticated users) -->
  @if (isAuthenticated()) {
    <mat-drawer
      #drawer
      mode="side"
      [opened]="true"
      [attr.aria-label]="'Navigation menu'"
      class="shell-drawer"
      [class.collapsed]="!isDrawerExpanded()"
    >
      <div class="drawer-header">
        <!-- Toggle button for mobile/collapsed state -->
        @if (isMobileView()) {
          <button
            matIconButton
            (click)="toggleDrawer()"
            class="drawer-toggle"
            [attr.aria-label]="'Close navigation'"
          >
            <mat-icon>chevron_left</mat-icon>
          </button>
        }
      </div>

      <nav class="sidebar-nav">
        <mat-nav-list class="nav-list">
          <!-- My Library Navigation -->
          <mat-list-item
            (click)="onNavigation('/app/library')"
            [class.active]="isRouteActive('/app/library')"
            class="nav-item"
            [matTooltip]="!isDrawerExpanded() ? 'My Library' : ''"
            matTooltipPosition="right"
          >
            <mat-icon matListItemIcon>library_music</mat-icon>
            @if (isDrawerExpanded()) {
              <span matListItemTitle>My Library</span>
            }
          </mat-list-item>

          <!-- Discover Navigation -->
          <mat-list-item
            (click)="onNavigation('/app/discover')"
            [class.active]="isRouteActive('/app/discover')"
            class="nav-item"
            [matTooltip]="!isDrawerExpanded() ? 'Discover' : ''"
            matTooltipPosition="right"
          >
            <mat-icon matListItemIcon>explore</mat-icon>
            @if (isDrawerExpanded()) {
              <span matListItemTitle>Discover</span>
            }
          </mat-list-item>
        </mat-nav-list>
      </nav>
    </mat-drawer>
  }

  <!-- Main Content Area -->
  <mat-drawer-content class="shell-content">
    <!-- Router outlet for child routes (/app/library, /app/discover) -->
    <router-outlet />
  </mat-drawer-content>
</mat-drawer-container>
