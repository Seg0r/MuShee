<main class="song-collection-root">
  <section class="song-collection-header">
    <div class="song-collection-header__titles">
      <h1>{{ headerTitle() }}</h1>
      @if (headerSubtitle()) {
        <p class="song-collection-header__subtitle">{{ headerSubtitle() }}</p>
      }
    </div>
    @if (headerControls().length) {
      <div class="song-collection-header-controls" role="toolbar" aria-label="Collection controls">
        @for (control of headerControls(); track control.id ?? control.label) {
          @if (control.type === 'select') {
            <mat-form-field appearance="outline" class="song-collection-control">
              <mat-label>{{ control.label }}</mat-label>
              <mat-select
                [value]="control.value"
                (selectionChange)="control.onValueChange($event.value)"
              >
                @for (option of control.options; track option.value) {
                  <mat-option [value]="option.value" [disabled]="option.disabled">
                    {{ option.label }}
                  </mat-option>
                }
              </mat-select>
            </mat-form-field>
          } @else if (control.type === 'search') {
            <mat-form-field appearance="outline" class="song-collection-control">
              <mat-label>{{ control.label }}</mat-label>
              <input
                matInput
                type="search"
                [value]="control.value"
                [placeholder]="control.placeholder ?? control.label"
                (input)="handleHeaderSearchInput(control, $event)"
              />
            </mat-form-field>
          }
        }
      </div>
    }
  </section>

  @if (isInitialLoading()) {
    <div class="loading-state">
      <app-loading-skeleton
        [count]="skeletonCount()"
        [rows]="skeletonRows()"
        [cols]="skeletonCols()"
      />
    </div>
  } @else {
    <div class="scroll-container" #scrollContainer>
      @if (shouldShowEmptyState() && emptyStateTemplate()) {
        <ng-container *ngTemplateOutlet="emptyStateTemplate()"></ng-container>
      } @else {
        <app-song-list
          [songs]="visibleSongs()"
          [isUserLibrary]="isUserLibraryView()"
          [isSongInLibrary]="config().isSongInLibrary || defaultSongInLibrary"
          [isAuthenticated]="resolveIsAuthenticated()"
          (tileClick)="tileClick.emit($event)"
          (addToLibrary)="addToLibrary.emit($event)"
          (deleteClick)="deleteClick.emit($event)"
        />
      }

      @if (isPaginationLoading()) {
        <div class="pagination-loading">
          <mat-spinner diameter="40"></mat-spinner>
          <p>Loading more songs...</p>
        </div>
      }
    </div>
  }

  @if (error()) {
    <div class="error-banner">
      <p>{{ error() }}</p>
      <button mat-button type="button" (click)="retry()">Retry</button>
    </div>
  }

  @if (showBackToTop() && isBackToTopVisible()) {
    <button
      mat-icon-button
      type="button"
      class="back-to-top-fab"
      (click)="scrollToTop()"
      aria-label="Scroll to top"
      [attr.aria-hidden]="!isBackToTopVisible()"
    >
      <mat-icon>arrow_upward</mat-icon>
    </button>
  }
</main>
