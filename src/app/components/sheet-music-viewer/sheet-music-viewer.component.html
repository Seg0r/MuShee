<!-- Full-screen sheet music viewer - no shell layout -->

<!-- Main Viewer Content - Always render to ensure container availability -->
<div class="viewer-container">
  <!-- Loading State Overlay -->
  @if (isLoading()) {
    <div class="viewer-loading">
      <mat-spinner diameter="50"></mat-spinner>
      <p>Loading sheet music...</p>
    </div>
  }

  <!-- Error State Overlay -->
  @if (error(); as errorMessage) {
    <div class="viewer-error">
      <mat-icon class="error-icon">error_outline</mat-icon>
      <h2>Unable to Load Sheet Music</h2>
      <p>{{ errorMessage }}</p>
      <button mat-button (click)="onBackClick()">
        <mat-icon>arrow_back</mat-icon>
        Go Back
      </button>
    </div>
  }

  <!-- Content visible only when not loading and no errors -->
  @if (!isLoading() && !error()) {
    <!-- Header with back button, song info, zoom controls, and rating -->
    <header class="viewer-header">
      <div class="header-left">
        <button
          mat-icon-button
          (click)="onBackClick()"
          class="back-button"
          [attr.aria-label]="'Go back to previous page'"
        >
          <mat-icon>arrow_back</mat-icon>
        </button>

        <div class="song-info">
          @if (song(); as songData) {
            <h1 class="song-title">{{ songData.song_details.title || 'Untitled' }}</h1>
            <p class="song-composer">{{ songData.song_details.composer || 'Unknown Composer' }}</p>
          }
        </div>
      </div>

      <!-- Zoom Controls - Centered -->
      <div class="zoom-controls">
        <button
          mat-icon-button
          (click)="onZoomOut()"
          [disabled]="!canZoomOut()"
          [attr.aria-label]="'Zoom out'"
        >
          <mat-icon>zoom_out</mat-icon>
        </button>

        <span class="zoom-level">{{ getZoomDisplay() }}</span>

        <button
          mat-icon-button
          (click)="onZoomIn()"
          [disabled]="!canZoomIn()"
          [attr.aria-label]="'Zoom in'"
        >
          <mat-icon>zoom_in</mat-icon>
        </button>
      </div>

      <!-- Feedback Controls -->
      <div class="header-right">
        @if (isUserAuthenticated()) {
          <div class="feedback-controls">
            <span class="feedback-label">Rate rendering:</span>
            <button
              mat-icon-button
              (click)="onThumbsUp()"
              [class.selected]="renderingFeedback() === 'thumbs_up'"
              [attr.aria-label]="'Thumbs up - good rendering'"
              class="thumbs-up"
            >
              <mat-icon>thumb_up</mat-icon>
            </button>
            <button
              mat-icon-button
              (click)="onThumbsDown()"
              [class.selected]="renderingFeedback() === 'thumbs_down'"
              [attr.aria-label]="'Thumbs down - poor rendering'"
              class="thumbs-down"
            >
              <mat-icon>thumb_down</mat-icon>
            </button>
          </div>
        } @else {
          <button mat-button (click)="onThumbsUp()" class="sign-in-prompt">Sign In</button>
        }
      </div>
    </header>
  }

  <!-- Sheet Music Canvas - Always present for OSMD initialization -->
  <main class="viewer-main">
    <div
      #osmdContainer
      class="osmd-container"
      [attr.aria-label]="'Rendered sheet music'"
      role="img"
    ></div>
  </main>
</div>
